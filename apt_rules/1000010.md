---
layout: default
---

| Threat |
| ---- |
| Muddywater |

#### 10000010
HTTP request constructed by a powershell script deployed onto victims

Powershell uses native windows web request apis

```ps
function httpGET($url){

	try
	{
		$webreq = [System.Net.WebRequest]::Create($url);
		$webreq.proxy = [Net.WebRequest]::GetSystemWebProxy()
		$webreq.proxy.Credentials = [Net.CredentialCache]::DefaultCredentials
		$webreq.Method = "GET";
		[System.Net.WebResponse] $resp = $webreq.GetResponse();
		if ($resp -ne $null){
			$data = $resp.GetResponseStream();
			[System.IO.StreamReader] $res_data = New-Object System.IO.StreamReader $data;
			[String] $result = $res_data.ReadToEnd();
		}
	} catch {
	    $result = ("httpGET:E:" + $_.Exception.Message)
	}

    return $result

  
}
```

##### Traffic sample
Taken from sample on [any.run](https://app.any.run/tasks/7a386637-5340-495d-ae0b-79b5544cbfbd/)

```
GET /cm/8913CAC9FEC5481A1C8544231FB8A0BA HTTP/1.1
Host: 46.166.129.200

```

Rule targets:

1. established tcp to server
2. Host value at end of http header names buffer
3. GET request in uri
4. Regular expression for UUID generated by powershell script


```c++
flow:established,to_server; http.header_names; content: "|0d 0a|Host|0d 0a 0d 0a|"; http.method; content: "GET"; http.uri; pcre: "/^\/[a-z]{2}\/[a-fA-F0-9]{32}$/";
```

This rule is seen often in conjuction with 10000011